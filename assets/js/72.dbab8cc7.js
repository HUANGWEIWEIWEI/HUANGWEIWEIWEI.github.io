(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{250:function(t,s,a){"use strict";a.r(s);var _=a(6),v=Object(_.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"_6-从输入url到得到html再到页面渲染以及针对性优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-从输入url到得到html再到页面渲染以及针对性优化"}},[t._v("#")]),t._v(" 6.从输入url到得到html再到页面渲染以及针对性优化")]),t._v(" "),a("p",[t._v("相关或类似的题目")]),t._v(" "),a("div",{staticClass:"language-md line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-md"}},[a("code",[t._v("1、浏览器输入URL后发生了什么/从输入url到得到html的详细过程/加载一个资源的过程/3次握手4次挥手?\n2、HTML页面渲染过程/浏览器渲染页面的过程?\n3、window.onload和DOMContentLoaded的区别?\n4、加载资源的形式?\n5、浏览器主要组件?\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("题目详解")]),t._v(" "),a("div",{staticClass:"language-md line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-md"}},[a("code",[t._v("大致过程：url--\x3e客户端--\x3eDNS服务器--\x3e服务器--\x3ehtml--\x3e解析渲染\n针对此过程提出优化\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("hr"),t._v(" "),a("h2",{attrs:{id:"_1-从输入url到得到html的详细过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-从输入url到得到html的详细过程"}},[t._v("#")]),t._v(" 1. 从输入url到得到html的详细过程")]),t._v(" "),a("h3",{attrs:{id:"_1-1-域名解析得到ip"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-域名解析得到ip"}},[t._v("#")]),t._v(" 1.1. 域名解析得到IP")]),t._v(" "),a("p",[t._v("浏览器开一个线程处理URL请求，同时在"),a("strong",[t._v("远程DNS服务器")]),t._v("启动一个DNS查询，这使浏览器得到请求对应的IP地址")]),t._v(" "),a("blockquote",[a("p",[t._v("DNS（Domain Name Server，域名服务器）是进行域名(domain name)和与之相对应的IP地址 (IP address)转换的服务器。"),a("br"),t._v("\nDNS中保存了一张域名(domain name)和与之相对应的IP地址 (IP address)的表，以解析消息的域名。"),a("br"),t._v("\n域名是Internet上某一台计算机或计算机组的名称，用于在数据传输时标识计算机的电子方位（有时也指地理位置）。域名是由一串用点分隔的名字组成的，通常包含组织名，而且始终包括两到三个字母的后缀，以指明组织的类型或该域所在的国家或地区。")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/hello_hww/img/raw/master/img1/20200621151917.png",alt:"DNS域名解析--DNS服务器层次结构"}})]),t._v(" "),a("p",[t._v("从客户端到本地服务器属于递归查询，而DNS服务器之间的交互属于迭代查询。")]),t._v(" "),a("p",[t._v("正常情况下，本地DNS服务器的缓存中已有comDNS服务器的地址，因此请求根域名服务器这一步不是必需的。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/hello_hww/img/raw/master/img1/20200621151949.png",alt:"DNS服务器的递归查询和迭代查询"}})]),t._v(" "),a("blockquote",[a("p",[t._v("客户端收到你输入的域名地址后，它首先去找本地的hosts文件，检查在该文件中是否有相应的域名、IP对应关系，如果有，则向其IP地址发送请求，如果没有，再去找DNS服务器。一般用户很少去编辑修改hosts文件。")])]),t._v(" "),a("h3",{attrs:{id:"_1-2-建立tcp链接（通过三次握手）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-建立tcp链接（通过三次握手）"}},[t._v("#")]),t._v(" 1.2. 建立TCP链接（通过三次握手）")]),t._v(" "),a("p",[t._v("对于客户端与服务器的TCP链接，必然要说的就是『三次握手』。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/hello_hww/img/raw/master/img1/20200621160602.png",alt:"三次握手"}})]),t._v(" "),a("ol",[a("li",[t._v("客户端发送一个TCP的SYN=1，Seq=X的包到服务器端口")]),t._v(" "),a("li",[t._v("服务器发回SYN=1， ACK=X+1， Seq=Y的响应包")]),t._v(" "),a("li",[t._v("客户端发送ACK=Y+1， Seq=Z")])]),t._v(" "),a("p",[t._v("上图也可以这么理解：")]),t._v(" "),a("p",[t._v("客户端：“你好，在家不，有你快递。”")]),t._v(" "),a("p",[t._v("服务端：“在的，送来就行。”")]),t._v(" "),a("p",[t._v("客户端：“好嘞。”")]),t._v(" "),a("p",[t._v("客户端发送一个带有SYN标志的数据包给服务端，服务端收到后，回传一个带有SYN/ACK标志的数据包以示传达确认信息，最后客户端再回传一个带ACK标志的数据包，代表握手结束，连接成功。")]),t._v(" "),a("h3",{attrs:{id:"_1-3-发送http请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-发送http请求"}},[t._v("#")]),t._v(" 1.3. 发送http请求")]),t._v(" "),a("p",[t._v("与服务器建立了连接后，就可以向服务器发起请求了。这里我们先看下请求报文的结构（如下图）：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/hello_hww/img/raw/master/img1/20200621160901.png",alt:"请求报文的结构"}})]),t._v(" "),a("p",[t._v("在浏览器中查看报文首部（以google浏览器为例）：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/hello_hww/img/raw/master/img1/20200621161429.png",alt:"报文首部"}})]),t._v(" "),a("p",[t._v("请求行包括请求方法、URI、HTTP版本。首部字段传递重要信息，包括请求首部字段、通用首部字段和实体首部字段。我们可以从报文中看到发出的请求的具体信息。具体每个首部字段的作用，这里不做过多阐述。")]),t._v(" "),a("h3",{attrs:{id:"_1-4-服务器处理http请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-服务器处理http请求"}},[t._v("#")]),t._v(" 1.4. 服务器处理http请求")]),t._v(" "),a("p",[t._v("服务器端收到请求后的由web服务器（准确说应该是http服务器）处理请求，诸如Apache、Ngnix、IIS等。web服务器解析用户请求，知道了需要调度哪些资源文件，再通过相应的这些资源文件处理用户请求和参数，并调用数据库信息，最后将结果通过web服务器返回给浏览器客户端。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/hello_hww/img/raw/master/img1/20200621161927.png",alt:"服务器处理http请求"}})]),t._v(" "),a("h3",{attrs:{id:"_1-5-服务器返回响应结果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-服务器返回响应结果"}},[t._v("#")]),t._v(" 1.5. 服务器返回响应结果")]),t._v(" "),a("p",[t._v("响应报文的组成结构：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/hello_hww/img/raw/master/img1/20200621162018.png",alt:"响应报文的组成结构"}})]),t._v(" "),a("p",[t._v("在响应结果中都会有个一个HTTP状态码，比如我们熟知的200、301、404、500等。通过这个状态码我们可以知道服务器端的处理是否正常，并能了解具体的错误。")]),t._v(" "),a("p",[t._v("状态码由3位数字和原因短语组成。根据首位数字，状态码可以分为五类：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th"),t._v(" "),a("th",[t._v("类别")]),t._v(" "),a("th",[t._v("原因短语")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("1xx")]),t._v(" "),a("td",[t._v("信息性状态码")]),t._v(" "),a("td",[t._v("接收请求正在处理")])]),t._v(" "),a("tr",[a("td",[t._v("2xx")]),t._v(" "),a("td",[t._v("成功状态码")]),t._v(" "),a("td",[t._v("请求正常处理完毕")])]),t._v(" "),a("tr",[a("td",[t._v("3xx")]),t._v(" "),a("td",[t._v("重定向状态码")]),t._v(" "),a("td",[t._v("需要进行附加操作以完成请求")])]),t._v(" "),a("tr",[a("td",[t._v("4xx")]),t._v(" "),a("td",[t._v("客户端错误状态码")]),t._v(" "),a("td",[t._v("服务器无法处理请求")])]),t._v(" "),a("tr",[a("td",[t._v("5xx")]),t._v(" "),a("td",[t._v("服务器错误状态码")]),t._v(" "),a("td",[t._v("服务器处理请求出错")])])])]),t._v(" "),a("h3",{attrs:{id:"_1-6-关闭tcp连接（通过四次挥手）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-关闭tcp连接（通过四次挥手）"}},[t._v("#")]),t._v(" 1.6. 关闭TCP连接（通过四次挥手）")]),t._v(" "),a("p",[t._v("为了避免服务器与客户端双方的资源占用和损耗，当双方没有请求或响应传递时，任意一方都可以发起关闭请求。与创建TCP连接的3次握手类似，关闭TCP连接，需要4次握手。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/hello_hww/img/raw/master/img1/20200621162920.png",alt:"4次握手"}})]),t._v(" "),a("p",[t._v("上图可以这么理解：")]),t._v(" "),a("p",[t._v("客户端：“兄弟，我这边没数据要传了，咱关闭连接吧。”")]),t._v(" "),a("p",[t._v("服务端：“收到，我看看我这边有木有数据了。”")]),t._v(" "),a("p",[t._v("服务端：“兄弟，我这边也没数据要传你了，咱可以关闭连接了。”")]),t._v(" "),a("p",[t._v("客户端：“好嘞。”")]),t._v(" "),a("blockquote",[a("p",[t._v("浏览器与远程Web服务器通过TCP3次握手建立一个TCP/IP连接.该握手包括一个同步报文，一个同步-应答报文和一个应答报文，这3个报文在浏览器和服务器之间传递。该握手首先由客户端尝试建立起通信，而后服务器应答并接受客户端的请求，最后由客户端发出该请求已被接收的报文。"),a("br"),t._v("\n一旦TCP/IP连接建立，浏览器会通过该链接向远程服务器发送HTTP的"),a("strong",[t._v("GET请求")]),t._v("。远程服务器找到资源并使用HTTP响应返回该资源，值为200的HTTP响应状态表示一个正确的响应。\n此时，Web服务器提供资源服务，客户端开始下载资源。")])]),t._v(" "),a("h2",{attrs:{id:"_2-html页面解析渲染过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-html页面解析渲染过程"}},[t._v("#")]),t._v(" 2. HTML页面解析渲染过程")]),t._v(" "),a("h3",{attrs:{id:"_2-1-解析html文件，创建dom树"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-解析html文件，创建dom树"}},[t._v("#")]),t._v(" 2.1. 解析html文件，创建DOM树")]),t._v(" "),a("p",[t._v("自上而下解析，遇到任何样式（link、style）和脚本（script）都会阻塞")]),t._v(" "),a("p",[t._v("1）css加载不会阻塞html文件的解析，但会阻塞dom的渲染")]),t._v(" "),a("p",[t._v("2）css加载会阻塞后面js语句的执行")]),t._v(" "),a("p",[t._v("3）js会阻塞html的解析和渲染，因为js有权利改变DOM结构，避免冲突从上到下执行")]),t._v(" "),a("p",[t._v("4）没有defer和async标签的script会立即加载并执行")]),t._v(" "),a("p",[t._v("5）有async标签的js，js的加载执行和html的解析和渲染并行")]),t._v(" "),a("p",[t._v("6）有defer标签的js，js的加载和html的解析和渲染并行，但会在html解析完成后执行,在触发DOMContentLoaded事件前执行")]),t._v(" "),a("p",[t._v("7）DOMContentLoaded和onload的区别：DOMContentLoaded在html解析完毕后执行，loload在页面完全加载完成后执行（包括样式和图片）")]),t._v(" "),a("blockquote",[a("p",[t._v("为什么要把CSS放在head中？\n先加载默认，又加载样式，用户体验差，性能体验差\n为什么要把script放在body最下面？\n不会阻塞HTML结构渲染，可以拿到所有的HTML")])]),t._v(" "),a("p",[t._v("构建过程：Bytes->Characters->Tokens->Nodes->Dom")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/hello_hww/img/raw/master/img1/20200621224616.png",alt:"DOM TREE 构建过程"}})]),t._v(" "),a("h3",{attrs:{id:"_2-2-解析css，生成cssom，css对象模型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-解析css，生成cssom，css对象模型"}},[t._v("#")]),t._v(" 2.2. 解析css，生成CSSOM，css对象模型")]),t._v(" "),a("p",[t._v("构建过程：Bytes->Characters->Tokens->Nodes->CSSOM")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/hello_hww/img/raw/master/img1/20200621224754.png",alt:"CSS TREE 构建过程"}})]),t._v(" "),a("h3",{attrs:{id:"_2-3-dom和css合并，构建渲染树（render-tree）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-dom和css合并，构建渲染树（render-tree）"}},[t._v("#")]),t._v(" 2.3. dom和css合并，构建渲染树（Render Tree）")]),t._v(" "),a("p",[t._v("1、过滤掉不可见节点(脚本标记、元标记)")]),t._v(" "),a("p",[t._v("2、过滤掉样式隐藏的节点（display:none）")]),t._v(" "),a("h3",{attrs:{id:"_2-4-布局（layout）和绘制（paint），重绘（repaint）和重排（reflow-回流）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-布局（layout）和绘制（paint），重绘（repaint）和重排（reflow-回流）"}},[t._v("#")]),t._v(" 2.4. 布局（Layout）和绘制（Paint），重绘（repaint）和重排（reflow/回流）")]),t._v(" "),a("p",[t._v("布局，计算每个对象的精确位置和大小。")]),t._v(" "),a("p",[t._v("绘制，使用最终渲染树将像素渲染到屏幕上。")]),t._v(" "),a("p",[t._v("重绘：根据元素的新属性重新绘制，使元素呈现新的外观")]),t._v(" "),a("p",[t._v("重排：当渲染树中的一部分因为元素的规模尺寸，布局，隐藏等改变而需要重新构建")]),t._v(" "),a("blockquote",[a("p",[t._v("重排必定会引发重绘，但重绘不一定会引发重排")])]),t._v(" "),a("div",{staticClass:"language-md line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-md"}},[a("code",[t._v("补充：\n监听资源加载完成有四种方式\n　　"),a("span",{pre:!0,attrs:{class:"token list punctuation"}},[t._v("1.")]),t._v(" window.onload = function(){....}\n　　"),a("span",{pre:!0,attrs:{class:"token list punctuation"}},[t._v("2.")]),t._v(' window.addEventListener("load",function(){....});\n　　'),a("span",{pre:!0,attrs:{class:"token list punctuation"}},[t._v("3.")]),t._v(" document.body.onload = function(){....}\n　　"),a("span",{pre:!0,attrs:{class:"token list punctuation"}},[t._v("4.")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("onload")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("load()"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("h2",{attrs:{id:"_3-从浏览器地址栏输入url到显示页面的步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-从浏览器地址栏输入url到显示页面的步骤"}},[t._v("#")]),t._v(" 3. 从浏览器地址栏输入url到显示页面的步骤")]),t._v(" "),a("p",[a("strong",[t._v("基础版本")])]),t._v(" "),a("ul",[a("li",[t._v("浏览器根据请求的 "),a("code",[t._v("URL")]),t._v("交给 "),a("code",[t._v("DNS")]),t._v("域名解析，找到真实 "),a("code",[t._v("IP")]),t._v("，向服务器发起请求；")]),t._v(" "),a("li",[t._v("服务器交给后台处理完成后返回数据，浏览器接收文件（ "),a("code",[t._v("HTML&#x3001;JS&#x3001;CSS")]),t._v("、图象等）；")]),t._v(" "),a("li",[t._v("浏览器对加载到的资源（ "),a("code",[t._v("HTML&#x3001;JS&#x3001;CSS")]),t._v("等）进行语法解析，建立相应的内部数据结构（如 "),a("code",[t._v("HTML")]),t._v("的 "),a("code",[t._v("DOM")]),t._v("）；")]),t._v(" "),a("li",[t._v("载入解析到的资源文件，渲染页面，完成。")])]),t._v(" "),a("p",[a("strong",[t._v("详细版")])]),t._v(" "),a("ol",[a("li",[t._v("在浏览器地址栏输入URL")]),t._v(" "),a("li",[t._v("浏览器查看 "),a("strong",[t._v("缓存")]),t._v("，如果请求资源在缓存中并且新鲜，跳转到转码步骤")]),t._v(" "),a("li",[t._v("如果资源未缓存，发起新请求")]),t._v(" "),a("li",[t._v("如果已缓存，检验是否足够新鲜，足够新鲜直接提供给客户端，否则与服务器进行验证。")]),t._v(" "),a("li",[t._v("检验新鲜通常有两个HTTP头进行控制 "),a("code",[t._v("Expires")]),t._v("和 "),a("code",[t._v("Cache-Control")]),t._v("：")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("+ HTTP1.0提供Expires，值为一个绝对时间表示缓存新鲜日期\n+ HTTP1.1增加了Cache-Control: max-age=,值为以秒为单位的最大新鲜时间\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("浏览器 "),a("strong",[t._v("解析URL")]),t._v("获取协议，主机，端口，path")]),t._v(" "),a("li",[t._v("浏览器 "),a("strong",[t._v("组装一个HTTP（GET）请求报文")])]),t._v(" "),a("li",[t._v("浏览器 "),a("strong",[t._v("获取主机ip地址")]),t._v("，过程如下：")]),t._v(" "),a("li",[t._v("浏览器缓存")]),t._v(" "),a("li",[t._v("本机缓存")]),t._v(" "),a("li",[t._v("hosts文件")]),t._v(" "),a("li",[t._v("路由器缓存")]),t._v(" "),a("li",[t._v("ISP DNS缓存")]),t._v(" "),a("li",[t._v("DNS递归查询（可能存在负载均衡导致每次IP不一样）")]),t._v(" "),a("li",[a("strong",[t._v("打开一个socket与目标IP地址，端口建立TCP链接")]),t._v("，三次握手如下：")]),t._v(" "),a("li",[t._v("客户端发送一个TCP的 "),a("strong",[t._v("SYN=1，Seq=X")]),t._v("的包到服务器端口")]),t._v(" "),a("li",[t._v("服务器发回 "),a("strong",[t._v("SYN=1， ACK=X+1， Seq=Y")]),t._v("的响应包")]),t._v(" "),a("li",[t._v("客户端发送 "),a("strong",[t._v("ACK=Y+1， Seq=Z")])]),t._v(" "),a("li",[t._v("TCP链接建立后 "),a("strong",[t._v("发送HTTP请求")])]),t._v(" "),a("li",[t._v("服务器接受请求并解析，将请求转发到服务程序，如虚拟主机使用HTTP Host头部判断请求的服务程序")]),t._v(" "),a("li",[t._v("服务器检查 "),a("strong",[t._v("HTTP请求头是否包含缓存验证信息")]),t._v("如果验证缓存新鲜，返回 "),a("strong",[t._v("304")]),t._v("等对应状态码")]),t._v(" "),a("li",[t._v("处理程序读取完整请求并准备HTTP响应，可能需要查询数据库等操作")]),t._v(" "),a("li",[t._v("服务器将 "),a("strong",[t._v("响应报文通过TCP连接发送回浏览器")])]),t._v(" "),a("li",[t._v("浏览器接收HTTP响应，然后根据情况选择 "),a("strong",[t._v("关闭TCP连接或者保留重用，关闭TCP连接的四次握手如下")]),t._v("：")]),t._v(" "),a("li",[t._v("主动方发送 "),a("strong",[t._v("Fin=1， Ack=Z， Seq= X")]),t._v("报文")]),t._v(" "),a("li",[t._v("被动方发送 "),a("strong",[t._v("ACK=X+1， Seq=Z")]),t._v("报文")]),t._v(" "),a("li",[t._v("被动方发送 "),a("strong",[t._v("Fin=1， ACK=X， Seq=Y")]),t._v("报文")]),t._v(" "),a("li",[t._v("主动方发送 "),a("strong",[t._v("ACK=Y， Seq=X")]),t._v("报文")]),t._v(" "),a("li",[t._v("浏览器检查响应状态吗：是否为1XX，3XX， 4XX， 5XX，这些情况处理与2XX不同")]),t._v(" "),a("li",[t._v("如果资源可缓存， "),a("strong",[t._v("进行缓存")])]),t._v(" "),a("li",[t._v("对响应进行 "),a("strong",[t._v("解码")]),t._v("（例如gzip压缩）")]),t._v(" "),a("li",[t._v("根据资源类型决定如何处理（假设资源为HTML文档）")]),t._v(" "),a("li",[a("strong",[t._v("解析HTML文档，构件DOM树，下载资源，构造CSSOM树，执行js脚本")]),t._v("，这些操作没有严格的先后顺序，以下分别解释")]),t._v(" "),a("li",[a("strong",[t._v("构建DOM树")]),t._v("：")]),t._v(" "),a("li",[a("strong",[t._v("Tokenizing")]),t._v("：根据HTML规范将字符流解析为标记")]),t._v(" "),a("li",[a("strong",[t._v("Lexing")]),t._v("：词法分析将标记转换为对象并定义属性和规则")]),t._v(" "),a("li",[a("strong",[t._v("DOM construction")]),t._v("：根据HTML标记关系将对象组成DOM树")]),t._v(" "),a("li",[t._v("解析过程中遇到图片、样式表、js文件， "),a("strong",[t._v("启动下载")])]),t._v(" "),a("li",[t._v("构建 "),a("strong",[t._v("CSSOM树")]),t._v("：")]),t._v(" "),a("li",[a("strong",[t._v("Tokenizing")]),t._v("：字符流转换为标记流")]),t._v(" "),a("li",[a("strong",[t._v("Node")]),t._v("：根据标记创建节点")]),t._v(" "),a("li",[a("strong",[t._v("CSSOM")]),t._v("：节点创建CSSOM树")]),t._v(" "),a("li",[a("strong",[a("a",{attrs:{href:"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/render-tree-construction",target:"_blank",rel:"https://dignified.cn"}},[t._v("根据DOM树和CSSOM树构建渲染树"),a("OutboundLink")],1)]),t._v(":")]),t._v(" "),a("li",[t._v("从DOM树的根节点遍历所有 "),a("strong",[t._v("可见节点")]),t._v("，不可见节点包括：1） "),a("code",[t._v("script")]),t._v(", "),a("code",[t._v("meta")]),t._v("这样本身不可见的标签。2)被css隐藏的节点，如 "),a("code",[t._v("display: none")])]),t._v(" "),a("li",[t._v("对每一个可见节点，找到恰当的CSSOM规则并应用")]),t._v(" "),a("li",[t._v("发布可视节点的内容和计算样式")]),t._v(" "),a("li",[a("strong",[t._v("js解析如下")]),t._v("：")]),t._v(" "),a("li",[t._v("浏览器创建Document对象并解析HTML，将解析到的元素和文本节点添加到文档中，此时 "),a("strong",[t._v("document.readystate为loading")])]),t._v(" "),a("li",[t._v("HTML解析器遇到 "),a("strong",[t._v("没有async和defer的script时")]),t._v("，将他们添加到文档中，然后执行行内或外部脚本。这些脚本会同步执行，并且在脚本下载和执行时解析器会暂停。这样就可以用document.write()把文本插入到输入流中。 "),a("strong",[t._v("同步脚本经常简单定义函数和注册事件处理程序，他们可以遍历和操作script和他们之前的文档内容")])]),t._v(" "),a("li",[t._v("当解析器遇到设置了 "),a("strong",[t._v("async")]),t._v("属性的script时，开始下载脚本并继续解析文档。脚本会在它 "),a("strong",[t._v("下载完成后尽快执行")]),t._v("，但是 "),a("strong",[t._v("解析器不会停下来等它下载")]),t._v("。异步脚本 "),a("strong",[t._v("禁止使用document.write()")]),t._v("，它们可以访问自己script和之前的文档元素")]),t._v(" "),a("li",[t._v("当文档完成解析，document.readState变成interactive")]),t._v(" "),a("li",[t._v("所有 "),a("strong",[t._v("defer")]),t._v("脚本会 "),a("strong",[t._v("按照在文档出现的顺序执行")]),t._v("，延迟脚本 "),a("strong",[t._v("能访问完整文档树")]),t._v("，禁止使用document.write()")]),t._v(" "),a("li",[t._v("浏览器 "),a("strong",[t._v("在Document对象上触发DOMContentLoaded事件")])]),t._v(" "),a("li",[t._v("此时文档完全解析完成，浏览器可能还在等待如图片等内容加载，等这些 "),a("strong",[t._v("内容完成载入并且所有异步脚本完成载入和执行")]),t._v("，document.readState变为complete，window触发load事件")]),t._v(" "),a("li",[a("strong",[t._v("显示页面")]),t._v("（HTML解析过程中会逐步显示页面）")])]),t._v(" "),a("p",[a("strong",[t._v("详细简版")])]),t._v(" "),a("ol",[a("li",[t._v("从浏览器接收 "),a("code",[t._v("url")]),t._v("到开启网络请求线程（这一部分可以展开浏览器的机制以及进程与线程之间的关系）")]),t._v(" "),a("li",[t._v("开启网络线程到发出一个完整的 "),a("code",[t._v("HTTP")]),t._v("请求（这一部分涉及到dns查询， "),a("code",[t._v("TCP/IP")]),t._v("请求，五层因特网协议栈等知识）")]),t._v(" "),a("li",[t._v("从服务器接收到请求到对应后台接收到请求（这一部分可能涉及到负载均衡，安全拦截以及后台内部的处理等等）")]),t._v(" "),a("li",[t._v("后台和前台的 "),a("code",[t._v("HTTP")]),t._v("交互（这一部分包括 "),a("code",[t._v("HTTP")]),t._v("头部、响应码、报文结构、 "),a("code",[t._v("cookie")]),t._v("等知识，可以提下静态资源的 "),a("code",[t._v("cookie")]),t._v("优化，以及编码解码，如 "),a("code",[t._v("gzip")]),t._v("压缩等）")]),t._v(" "),a("li",[t._v("单独拎出来的缓存问题， "),a("code",[t._v("HTTP")]),t._v("的缓存（这部分包括http缓存头部， "),a("code",[t._v("ETag")]),t._v("， "),a("code",[t._v("catch-control")]),t._v("等）")]),t._v(" "),a("li",[t._v("浏览器接收到 "),a("code",[t._v("HTTP")]),t._v("数据包后的解析流程（解析 "),a("code",[t._v("html")]),t._v("-词法分析然后解析成 "),a("code",[t._v("dom")]),t._v("树、解析 "),a("code",[t._v("css")]),t._v("生成 "),a("code",[t._v("css")]),t._v("规则树、合并成 "),a("code",[t._v("render")]),t._v("树，然后 "),a("code",[t._v("layout")]),t._v("、 "),a("code",[t._v("painting")]),t._v("渲染、复合图层的合成、 "),a("code",[t._v("GPU")]),t._v("绘制、外链资源的处理、 "),a("code",[t._v("loaded")]),t._v("和 "),a("code",[t._v("DOMContentLoaded")]),t._v("等）")]),t._v(" "),a("li",[a("code",[t._v("CSS")]),t._v("的可视化格式模型（元素的渲染规则，如包含块，控制框， "),a("code",[t._v("BFC")]),t._v("， "),a("code",[t._v("IFC")]),t._v("等概念）")]),t._v(" "),a("li",[a("code",[t._v("JS")]),t._v("引擎解析过程（ "),a("code",[t._v("JS")]),t._v("的解释阶段，预处理阶段，执行阶段生成执行上下文， "),a("code",[t._v("VO")]),t._v("，作用域链、回收机制等等）")]),t._v(" "),a("li",[t._v("其它（可以拓展不同的知识模块，如跨域，web安全， "),a("code",[t._v("hybrid")]),t._v("模式等等内容）")])]),t._v(" "),a("h2",{attrs:{id:"_4-window-onload和domcontentloaded的区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-window-onload和domcontentloaded的区别"}},[t._v("#")]),t._v(" 4. window.onload和DOMContentLoaded的区别")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'load'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//页面的全部资源加载完才会执行，包括图片，视频")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DOMContentLoaded'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//DOM 渲染完即可执行，此时图片，视频换坑能没有加载完成")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("h2",{attrs:{id:"_5-加载资源的形式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-加载资源的形式"}},[t._v("#")]),t._v(" 5. 加载资源的形式")]),t._v(" "),a("p",[t._v("输入url（或跳转页面）加载html")]),t._v(" "),a("div",{staticClass:"language-md line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-md"}},[a("code",[t._v("http://coding.m.imooc.com\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("加载html中的静态资源")]),t._v(" "),a("div",{staticClass:"language-md line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-md"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("/static/js/jquery.js"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}}),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h2",{attrs:{id:"_6-针对性优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-针对性优化"}},[t._v("#")]),t._v(" 6. 针对性优化")]),t._v(" "),a("h3",{attrs:{id:"_6-1-问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-问题"}},[t._v("#")]),t._v(" 6.1. 问题")]),t._v(" "),a("p",[t._v("白屏时间过长;h5浪费用户流量,用户体验差")]),t._v(" "),a("p",[t._v("产生的原因：网络问题、关键渲染路径（CRP）问题")]),t._v(" "),a("h3",{attrs:{id:"_6-2-怎么做优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-怎么做优化"}},[t._v("#")]),t._v(" 6.2. 怎么做优化")]),t._v(" "),a("p",[t._v("如何做好优化呢，网上随便一搜，就有很多优化总结，无非就是网络优化、静态资源（html、js、css、image）优化。下面我们撇开网络方面的优化，只分析静态资源方面的优化。而静态资源的优化关键在于你要去深入理解"),a("code",[t._v("关键渲染路径（CRP）")]),t._v("的运行原理和规则。")]),t._v(" "),a("p",[t._v("使用一些工具，帮助我们去评估现有页面的CRP(关键渲染路径)性能。")]),t._v(" "),a("blockquote",[a("p",[t._v("测试工具：Lighthouse 可以快速测试你的网页，并提供性能报告\n监控工具：Nivigation Timing Api 设置你的代码，实时监控用户使用过程中的性能。")])]),t._v(" "),a("p",[t._v("javascript阻止DOM构建（ DOMContentLoaded触发被延迟），css的下载和完成阻止javascript的执行。在没有javascript或者只含有异步javascript的页面中，DOM的构建和CSSOM的构建互不影响。")]),t._v(" "),a("p",[t._v("以下是优化方案：")]),t._v(" "),a("div",{staticClass:"language-md line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-md"}},[a("code",[t._v("1、降低请求数量\n    a、减少获取数据的接口数（初始数据尽量通过一个接口返回）\n    b、减少js、css的数量（提取公共js、css利用缓存、减少后续加载访问。有些代码直接注入页面无需外链形式访问加载。）\n    c、图片懒加载\n2、降低文件大小\n    a、图片压缩以及使用webp\n    b、压缩js、css\n    c、gzip（设置content-encoding:gzip）\n    d、icon或者svg绘制图标\n3、加快请求速度\n    a、DNS预解析\n    b、减少域名数量(页面、js、css、image、接口域名、同种类型文本请求尽量同域名。)\n    c、静态资源cdn分发\n    d、提前加载（提前加载一部分可能被用户访问的图片或者数据信息）\n4、缓存\n    a、http协议缓存\n    b、离线数据缓存localStorage\n5、渲染\n    a、js、css优化(按照规范来写)\n    b、服务器渲染\n    c、能异步加载的js要异步加载\n    d、js不要修改dom和css，避免重绘\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br")])]),a("blockquote",[a("p",[t._v("DNS预解析 "),a("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Controlling_DNS_prefetching",target:"_blank",rel:"https://dignified.cn"}},[t._v("https://developer.mozilla.org/zh-CN/docs/Controlling_DNS_prefetching"),a("OutboundLink")],1),t._v("\ngoogle规范 "),a("a",{attrs:{href:"https://google.github.io/styleguide/jsguide.html#guide-notes",target:"_blank",rel:"https://dignified.cn"}},[t._v("https://google.github.io/styleguide/jsguide.html#guide-notes"),a("OutboundLink")],1)])]),t._v(" "),a("h2",{attrs:{id:"_7-参考文章"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-参考文章"}},[t._v("#")]),t._v(" 7. 参考文章")]),t._v(" "),a("p",[t._v("“天龙八步”细说浏览器输入URL后发生了什么\n"),a("a",{attrs:{href:"https://www.xuecaijie.com/it/157.html#1Q64dG0mJ2gKFF",target:"_blank",rel:"https://dignified.cn"}},[t._v("https://www.xuecaijie.com/it/157.html#1Q64dG0mJ2gKFF"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("页面渲染过程解析\n"),a("a",{attrs:{href:"https://segmentfault.com/a/1190000015019450#item-2-3",target:"_blank",rel:"https://dignified.cn"}},[t._v("https://segmentfault.com/a/1190000015019450#item-2-3"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("前端性能优化知识点汇总\n"),a("a",{attrs:{href:"https://segmentfault.com/a/1190000013363147",target:"_blank",rel:"https://dignified.cn"}},[t._v("https://segmentfault.com/a/1190000013363147"),a("OutboundLink")],1)]),t._v(" "),a("comment-comment")],1)}),[],!1,null,null,null);s.default=v.exports}}]);